<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Airline Miles Calculator</title>
<style>
:root {
  --glass-bg: rgba(255,255,255,0.15);
  --glass-border: rgba(255,255,255,0.25);
  --text-color: #000;
  --bg-color: #f0f0f5;
  --dropdown-bg: rgba(255,255,255,0.9);
}
@media (prefers-color-scheme: dark) {
  :root {
    --glass-bg: rgba(0,0,0,0.25);
    --glass-border: rgba(255,255,255,0.1);
    --text-color: #fff;
    --bg-color: #111;
    --dropdown-bg: rgba(0,0,0,0.8);
  }
}
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  margin:0;
  background: var(--bg-color);
  color: var(--text-color);
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
  padding:2rem;
}
.container {
  width: 100%;
  max-width: 950px;
  display:grid;
  grid-template-columns: 1fr;
  gap:1.5rem;
}
.card {
  background: var(--glass-bg);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border);
  border-radius: 1.5rem;
  padding:1.5rem;
  box-shadow: 0 8px 32px rgba(0,0,0,0.1);
  transition:0.3s;
}
h1 {text-align:center; font-size:2rem; margin-bottom:1rem;}
input, select, button {
  width:100%; padding:0.8rem; margin:0.5rem 0; border-radius:1rem; border:none;
  font-size:1rem; background: var(--dropdown-bg); color: var(--text-color);
}
button {background:#007aff; color:white; cursor:pointer; transition:0.3s;}
button:hover {background:#005bb5;}
#map {height:300px; border-radius:1.5rem; margin-top:1rem;}
.result {margin-top:1rem; font-size:1.2rem; font-weight:600; text-align:center;}
.comparison {margin-top:1rem; display:flex; justify-content:space-around; flex-wrap:wrap;}
.comp-card {background: var(--glass-bg); border:1px solid var(--glass-border); border-radius:1rem; padding:0.8rem; margin:0.5rem; flex:1 1 30%; text-align:center;}
.autocomplete-suggestions {
  background: var(--dropdown-bg);
  border: 1px solid var(--glass-border);
  border-radius: 0.8rem;
  max-height: 150px;
  overflow-y: auto;
  position: absolute;
  z-index:1000;
}
.autocomplete-suggestion {padding:0.5rem; cursor:pointer;}
.autocomplete-suggestion:hover {background: rgba(0,0,0,0.1);}
</style>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
</head>
<body>
<div class="container">
  <div class="card">
    <h1>Airline Miles Calculator</h1>
    <label>From Airport</label>
    <input id="from" placeholder="Airport code or city name">
    <div id="from-suggestions" class="autocomplete-suggestions"></div>
    <label>To Airport</label>
    <input id="to" placeholder="Airport code or city name">
    <div id="to-suggestions" class="autocomplete-suggestions"></div>
    <label>Airline</label>
    <select id="airline">
      <option value="cathay">Cathay Pacific</option>
      <option value="chinaEastern">China Eastern</option>
      <option value="finnair">Finnair</option>
      <option value="juneyao">Juneyao Airlines</option>
      <option value="airChina">Air China</option>
      <option value="chinaSouthern">China Southern</option>
      <option value="asiana">Asiana Airlines</option>
      <option value="singapore">Singapore Airlines</option>
      <option value="thai">Thai Airways</option>
    </select>
    <label>Loyalty Program</label>
    <select id="program">
      <option value="aadvantage">AAdvantage</option>
      <option value="qantas">Qantas Frequent Flyer</option>
      <option value="finnairPlus">Finnair Plus</option>
      <option value="cathay">Cathay Marco Polo</option>
      <option value="flyingBlue">Flying Blue</option>
      <option value="krisflyer">KrisFlyer</option>
      <option value="mileageplus">MileagePlus</option>
    </select>
    <button id="calc">Calculate Miles</button>
    <div class="result" id="result"></div>
    <div class="comparison" id="comparison"></div>
  </div>
  <div class="card">
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// Expanded Airport Database (partial, can scale)
const airports = [
  {code:"PVG", city:"Shanghai", name:"Shanghai Pudong Intl", lat:31.1443, lon:121.8083},
  {code:"HKG", city:"Hong Kong", name:"Hong Kong Intl", lat:22.308, lon:113.9185},
  {code:"SIN", city:"Singapore", name:"Singapore Changi", lat:1.3644, lon:103.9915},
  {code:"ICN", city:"Seoul", name:"Incheon Intl", lat:37.4602, lon:126.4407},
  {code:"BKK", city:"Bangkok", name:"Suvarnabhumi", lat:13.6811, lon:100.7473},
  {code:"PEK", city:"Beijing", name:"Beijing Capital", lat:40.0799, lon:116.6031},
  {code:"CAN", city:"Guangzhou", name:"Guangzhou Baiyun", lat:23.3924, lon:113.2988},
  {code:"NRT", city:"Tokyo", name:"Narita Intl", lat:35.772, lon:140.392},
  {code:"FRA", city:"Frankfurt", name:"Frankfurt Intl", lat:50.0379, lon:8.5622},
  {code:"LHR", city:"London", name:"Heathrow", lat:51.470, lon:-0.4543},
  {code:"CDG", city:"Paris", name:"Charles de Gaulle", lat:49.0097, lon:2.5479}
];

// Correct Alliances
const alliances = {
  Oneworld:["cathay","qantas","british","aadvantage","jal"],
  SkyTeam:["chinaEastern","flyingBlue","delta","korean","chinaAirlines"],
  StarAlliance:["airChina","singapore","thai","asiana","mileageplus"]
};

// Example Earning Rates (business class multipliers)
const earningRates = {
  cathay: { aadvantage:1.25, qantas:1, cathay:1.25 },
  chinaEastern:{ flyingBlue:1.2 },
  finnair:{ finnairPlus:1.5 },
  juneyao:{ aadvantage:1, qantas:0.8 },
  airChina:{ mileageplus:1 },
  chinaSouthern:{ mileageplus:0.85 },
  asiana:{ mileageplus:1.2 },
  singapore:{ krisflyer:1.3 },
  thai:{ krisflyer:1.2 }
};

// Autocomplete
function setupAutocomplete(inputId, suggestionsId){
  const input = document.getElementById(inputId);
  const suggestionBox = document.getElementById(suggestionsId);
  input.addEventListener("input",()=>{
    const val = input.value.toLowerCase();
    suggestionBox.innerHTML="";
    if(val.length===0) return;
    const filtered = airports.filter(a=>a.code.toLowerCase().includes(val)||a.city.toLowerCase().includes(val)||a.name.toLowerCase().includes(val));
    filtered.forEach(a=>{
      const div = document.createElement("div");
      div.className="autocomplete-suggestion";
      div.innerText=`${a.city} (${a.code}) - ${a.name}`;
      div.addEventListener("click",()=>{
        input.value=a.code;
        suggestionBox.innerHTML="";
      });
      suggestionBox.appendChild(div);
    });
  });
}
setupAutocomplete("from","from-suggestions");
setupAutocomplete("to","to-suggestions");

// Map
const map = L.map('map').setView([20,100],3);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ maxZoom:19 }).addTo(map);
let routeLine;

// Miles Calculation + Compare
document.getElementById("calc").addEventListener("click",()=>{
  const fromCode = document.getElementById("from").value.toUpperCase();
  const toCode = document.getElementById("to").value.toUpperCase();
  const airline = document.getElementById("airline").value;
  const program = document.getElementById("program").value;

  const fromAirport = airports.find(a=>a.code===fromCode);
  const toAirport = airports.find(a=>a.code===toCode);
  if(!fromAirport || !toAirport){alert("Airport not found!"); return;}

  const distance = Math.sqrt(Math.pow(fromAirport.lat-toAirport.lat,2)+Math.pow(fromAirport.lon-toAirport.lon,2))*111;
  const miles = Math.round((earningRates[airline] && earningRates[airline][program]) ? distance*earningRates[airline][program] :
