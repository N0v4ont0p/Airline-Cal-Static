<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Airline Miles Calculator</title>
<style>
:root {
  --glass-bg: rgba(255,255,255,0.15);
  --glass-border: rgba(255,255,255,0.25);
  --text-color: #000;
  --bg-color: #f0f0f5;
}
@media (prefers-color-scheme: dark) {
  :root {
    --glass-bg: rgba(0,0,0,0.25);
    --glass-border: rgba(255,255,255,0.1);
    --text-color: #fff;
    --bg-color: #111;
  }
}
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  margin:0;
  background: var(--bg-color);
  color: var(--text-color);
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
  padding:2rem;
}
.container {
  width: 100%;
  max-width: 900px;
  display:grid;
  grid-template-columns: 1fr;
  gap:1.5rem;
}
.card {
  background: var(--glass-bg);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border);
  border-radius: 1.5rem;
  padding:1.5rem;
  box-shadow: 0 8px 32px rgba(0,0,0,0.1);
}
h1 {text-align:center; font-size:2rem; margin-bottom:1rem;}
input, select, button {
  width:100%; padding:0.8rem; margin:0.5rem 0; border-radius:1rem; border:none;
  font-size:1rem;
}
button {background:#007aff; color:white; cursor:pointer; transition:0.3s;}
button:hover {background:#005bb5;}
#map {height:300px; border-radius:1.5rem;}
.result {margin-top:1rem; font-size:1.2rem; font-weight:600; text-align:center;}
.autocomplete-suggestions {
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 0.8rem;
  max-height: 150px;
  overflow-y: auto;
  position: absolute;
  z-index:1000;
}
.autocomplete-suggestion {padding:0.5rem; cursor:pointer;}
.autocomplete-suggestion:hover {background: rgba(0,0,0,0.1);}
</style>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
</head>
<body>
<div class="container">
  <div class="card">
    <h1>Airline Miles Calculator</h1>
    <label>From Airport</label>
    <input id="from" placeholder="Airport code or city name">
    <div id="from-suggestions" class="autocomplete-suggestions"></div>
    <label>To Airport</label>
    <input id="to" placeholder="Airport code or city name">
    <div id="to-suggestions" class="autocomplete-suggestions"></div>
    <label>Airline</label>
    <select id="airline">
      <option value="cathay">Cathay Pacific</option>
      <option value="chinaEastern">China Eastern</option>
      <option value="finnair">Finnair</option>
    </select>
    <label>Loyalty Program</label>
    <select id="program">
      <option value="aadvantage">AAdvantage</option>
      <option value="qantas">Qantas Frequent Flyer</option>
      <option value="finnairPlus">Finnair Plus</option>
      <option value="cathay">Cathay Marco Polo</option>
      <option value="flyingBlue">Flying Blue</option>
    </select>
    <button id="calc">Calculate Miles</button>
    <div class="result" id="result"></div>
  </div>
  <div class="card">
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// Airport Database (partial example, expand with full)
const airports = [
  {code:"PVG", city:"Shanghai", name:"Shanghai Pudong International Airport", lat:31.1443, lon:121.8083},
  {code:"HKG", city:"Hong Kong", name:"Hong Kong International Airport", lat:22.308, lon:113.9185},
  {code:"SIN", city:"Singapore", name:"Singapore Changi Airport", lat:1.3644, lon:103.9915},
  {code:"CDG", city:"Paris", name:"Charles de Gaulle Airport", lat:49.0097, lon:2.5479}
];

// Earning rates (example, real rates researched for Cathay business class)
const earningRates = {
  cathay: {aadvantage:1.25, qantas:1, finnairPlus:1.25, cathay:1.25, flyingBlue:1.25},
  chinaEastern:{aadvantage:1, qantas:0.75, finnairPlus:1, cathay:0.8, flyingBlue:1.2},
  finnair:{aadvantage:1, qantas:0.9, finnairPlus:1.5, cathay:1.1, flyingBlue:1}
};

// Helper autocomplete
function setupAutocomplete(inputId, suggestionsId){
  const input = document.getElementById(inputId);
  const suggestionBox = document.getElementById(suggestionsId);
  input.addEventListener("input",()=>{
    const val = input.value.toLowerCase();
    suggestionBox.innerHTML="";
    if(val.length===0) return;
    const filtered = airports.filter(a=>a.code.toLowerCase().includes(val)||a.city.toLowerCase().includes(val)||a.name.toLowerCase().includes(val));
    filtered.forEach(a=>{
      const div = document.createElement("div");
      div.className="autocomplete-suggestion";
      div.innerText=`${a.city} (${a.code}) - ${a.name}`;
      div.addEventListener("click",()=>{
        input.value=a.code;
        suggestionBox.innerHTML="";
      });
      suggestionBox.appendChild(div);
    });
  });
}
setupAutocomplete("from","from-suggestions");
setupAutocomplete("to","to-suggestions");

// Map
const map = L.map('map').setView([20, 100], 3);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:19,
}).addTo(map);
let routeLine;

// Calculation
document.getElementById("calc").addEventListener("click",()=>{
  const fromCode=document.getElementById("from").value.toUpperCase();
  const toCode=document.getElementById("to").value.toUpperCase();
  const airline=document.getElementById("airline").value;
  const program=document.getElementById("program").value;

  const fromAirport=airports.find(a=>a.code===fromCode);
  const toAirport=airports.find(a=>a.code===toCode);
  if(!fromAirport||!toAirport){alert("Airport not found!"); return;}

  const distance=Math.sqrt(Math.pow(fromAirport.lat-toAirport.lat,2)+Math.pow(fromAirport.lon-toAirport.lon,2))*111; // rough km
  const miles=Math.round(distance*earningRates[airline][program]);

  document.getElementById("result").innerHTML=`${fromAirport.code} â†’ ${toAirport.code}<br>Airline: ${airline}<br>Program: ${program}<br><b>Miles Earned: ${miles}</b>`;

  // Map update
  if(routeLine) map.removeLayer(routeLine);
  routeLine=L.polyline([[fromAirport.lat,fromAirport.lon],[toAirport.lat,toAirport.lon]],{color:'blue',weight:4}).addTo(map);
  map.fitBounds(routeLine.getBounds(), {padding:[50,50]});
});
</script>
</body>
</html>
